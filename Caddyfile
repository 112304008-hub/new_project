{$DOMAIN} {
	encode zstd gzip
	@health path /health

	# Proxy all requests to the app service
	reverse_proxy web:8000 {
		# Preserve host and IP info
		headers_up X-Forwarded-For {remote}
		headers_up X-Forwarded-Proto {scheme}
		headers_up X-Forwarded-Host {host}
	}

	# Optional: cache static assets aggressively
	@static {
		path "/static/*"
	}
	handle @static {
		headers {
			Cache-Control "public, max-age=31536000, immutable"
		}
		rewrite * /static/{path}
	}

	# Health passthrough
	handle @health {
		rewrite * /health
	}

	# Prometheus/metrics may be sensitive; restrict if needed
	# @metrics path /metrics
	# respond @metrics 403
}
